!function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/addComponentModal.html",'<div class="stamp-modal stamp-modal-add-component modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-label="Close" data-ng-click="close()"><span aria-hidden="true">&times;</span></button>\n    <h4 class="modal-title">Add Component</h4>\n  </div>\n  <div class="modal-body">\n    <div class="component-list">\n      <div class="component-list-item" data-ng-class="{\'no-icon\' : !value.icon}" data-ng-repeat="(key, value) in components" data-ng-click="insert(key)">\n        <i class="{{value.icon}}" data-ng-if="value.icon"></i>\n        <span>{{value.label}}</span>\n      </div>\n    </div>\n  </div>\n</div>')}])}(),function(t){if(t.htmlMapper=function(t,n,a){function o(n,o){Object.keys(t.stampBlockControls).forEach(function(e,l){var i=t.stampBlockControls[e];void 0!==i.preRender&&(n=i.preRender.call(a,n,o))});var l=e(n,o);return Object.keys(t.stampBlockControls).forEach(function(n,e){var i=t.stampBlockControls[n];void 0!==i.postRender&&(l=i.postRender.call(a,l,o))}),l}function e(n,a){var o=n.attributes&&n.attributes.layout?n.attributes.layout:"fluid",e=t.stampLayouts[o],i="";if(!e){if("fluid"===o)return console.log("Warning! Missing layout config and fallback fluid layout. Exiting."),i;console.log("Warning! Missing layout config, reverting to fluid"),o="fluid",e=t.stampLayouts.fluid}return i+="fluid"!==o?'<div class="row">':"<div>",n.columns.forEach(function(t,n){if(void 0!==e.maxColumns&&n+1>e.maxColumns)return void console.log("Warning! Data exceeds maxColumns for this layout, Omitting extra columns.");var s=l(t,"fluid"===o?!1:n,e,a);s&&(i+=s)}),i+="</div>"}function l(t,n,a){var o='<div class="';if(n!==!1){var e=c(n,a);o+=e}return o+='">',t.components.forEach(function(t,n){var e=i(t,n,a);e&&(o+=e)}),o+="</div>"}function i(n,o,e){var l="";return Object.keys(t.stampComponentControls).forEach(function(e,l){var i=t.stampComponentControls[e];void 0!==i.preRender&&(n=i.preRender.call(a,n,o))}),l=s(n,o,e),Object.keys(t.stampComponentControls).forEach(function(n,e){var i=t.stampComponentControls[n];void 0!==i.postRender&&(l=i.postRender.call(a,l,o))}),l}function s(n,o,e){var l=t.stampComponents[n.type];return l?l.toHTML?l.toHTML.call(a,n,e):(console.log("Warning! Component is missing a toHTML function: "+n.type),""):(console.log("Warning! Missing component: "+n.type),"")}function c(t,n){var a="";if(void 0===n.columnStyles)a+="col-md-12";else if("string"==typeof n.columnStyles)a+="col-"+n.columnStyles;else for(var o in n.columnStyles)if(n.columnStyles.hasOwnProperty(o)){var e=n.columnStyles[o];if(Array.isArray(e)){var l=t>e.length-1?e.length-1:t;a+="col-"+o+"-"+e[l]}else a+="col-"+o+"-"+e;a+=" "}return a}var r="";return a=a||{},n&&n.blocks?(n.blocks.forEach(function(t,n){r+=o(t,n)}),r):r},angular){var n=angular.module("stamp.mappers",[]);n.factory("StampHTML",["stampLayouts","stampComponents","stampComponentControls","stampBlockControls",function(n,a,o,e){function l(n){try{return t.htmlMapper(i,n)}catch(a){console.log("Warning! Failed to export Stamp JSON to HTML",a)}}var i={stampLayouts:n,stampBlockControls:e,stampComponents:a,stampComponentControls:o};return{generate:function(t){return console.log("Called stamp.mappers.StampHTML.generate [JSON -> HTML]"),l(t)}}}])}}("undefined"==typeof exports?window._stampMappers={}:exports),function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/block.html",'<div class="block-header clearfix">\n    <span class="pull-right">\n      <span uib-dropdown="">\n        <a href="" id="simple-dropdown" uib-dropdown-toggle="">Layout: {{layouts[data.attributes.layout].label}}</a>\n        <ul class="dropdown-menu" uib-dropdown-menu="" aria-labelledby="simple-dropdown">\n          <li data-ng-repeat="(key, value) in layouts">\n            <a data-ng-click="changeLayout(key)">{{key == \'fluid\' ? \'Remove Layout (Fluid)\' : value.label}}</a>\n          </li>\n        </ul>\n      </span>\n      <a data-ng-if="blockIndex !== 0" data-ng-click="moveUp()">&#9650;</a>\n      <a data-ng-if="blockIndex !== blockCount - 1" data-ng-click="moveDown()">&#9660;</a>\n      <button type="button" class="close" aria-label="remove" data-ng-click="remove()"><span aria-hidden="true">&times;</span></button>\n    </span>\n</div>\n<div class="alert alert-danger" data-ng-if="layout.maxColumns && layout.maxColumns < data.columns.length">This layout has a column limit of {{layout.maxColumns}}, the column count is {{data.columns.length}}, switch to a {{data.columns.length}} column layout</div>\n<div class="block-body">\n  <div data-ng-class="getColumnClasses($index)" data-ng-repeat="column in data.columns track by $index">\n    <div class="stamp-component-wrapper component-{{$index}}" data-ng-repeat="component in column.components track by $index">\n      <stamp-component data="component" col-index="$parent.$index" com-index="$index" com-count="column.components.length"></stamp-component>\n    </div>\n    <div data-ng-if="!parent.locked && !parent.readOnly">\n      <input class="btn btn-warning btn-lg btn-block" type="button" value="Remove Column" data-ng-if="column.components.length == 0" data-ng-click="removeColumn($index)">\n      <input class="btn btn-default btn-lg btn-block" type="button" value="+ Component" data-ng-click="addComponent($parent.$index)">\n    </div>\n  </div>\n  <!-- enable this instead of the below option when you\'ve added the ability to add no middle column if 3 are missing on a 3 col layout <div ng-if="emptyColumnCount().length > 0" ng-class="getColumnClasses($index, true)" ng-repeat="emptyColumn in emptyColumnCount() track by $index">\n    <div ng-if="!parent.locked && !parent.readOnly"><input class="btn btn-default btn-lg btn-block" type="button" ng-click="addColumn($index)" value="+ Column"></input></div>\n  </div>-->\n  <div data-ng-if="!parent.locked && !parent.readOnly && (emptyColumnCount().length > 0  && data.attributes.layout != \'fluid\' || data.attributes.layout == \'fluid\' && data.columns.length == 0)" data-ng-class="getColumnClasses(0, true)">\n    <input class="btn-block btn btn-default btn-lg" type="button" value="+ Column" data-ng-click="addColumn()">\n  </div>\n</div>')}])}(),function(){function t(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var n=angular.module("stamp",["stamp.mappers","stampSetup","ui.bootstrap"]);n.value("stampConfig",{}),n.directive("stampEditor",["$rootScope","$compile","$timeout","$window","stampConfig",function(t,n,a,o,e){e=e||{};var l=0,i="ui-stamp-editor-";return{require:"ngModel",templateUrl:"../src/angular/templates/editor.html",link:function(t,n,a,o){function s(){t.locked=a.locked}function c(){t.readOnly=a.readOnly}var r={},u={};t.json={},a.$set("id",i+l++),console.log("Stamp directive given ID: "+i+l),angular.extend(u,t.$eval(a.stampOptions)),angular.extend(r,e,u),t.attributes=angular.extend({locked:!1,readOnly:!1},{locked:!!a.locked,readOnly:!!a.readOnly},r),a.$observe("locked",s),a.$observe("readOnly",c),a.ngModel?t.$watch(function(){return JSON.stringify(o.$modelValue)},function(n,a){console.log("ngModel value changed via model watch"),t.json=o.$modelValue}):console.log("Warning: missing ng-model definition on stamp editor"),t.addBlock=function(n){t.json.blocks.splice(void 0!==n?n:t.json.blocks.length,0,{attributes:{layout:"oneColumn"},columns:[{components:[{type:"text",data:{}}]}]})}},controller:["$scope",function(t){this.removeBlock=function(n){t.json.blocks.splice(n,1)},this.moveBlock=function(n,a){var o=t.json.blocks.splice(n,1);t.json.blocks.splice(a,0,o[0])}}]}}]),n.directive("stampAutoHeight",function(t){return{restrict:"A",link:function(n,a){var o=function(){var t=a[0].scrollHeight;25>t?a[0].style.height="25px":(t+=10,a[0].style.height=t+"px")};n.$on("layoutChanged",function(){a[0].style.height="auto",t(o,10)}),t(o,0)}}}),n.directive("stampBlock",["stampLayouts","$uibModal",function(t,n){return{restrict:"E",require:"^stampEditor",templateUrl:"../src/angular/templates/block.html",scope:{data:"=",blockIndex:"=",blockCount:"="},link:function(a,o,e,l){function i(n,o){return a.layout=t[o],a.blockError=!1,a.layout?(void 0!==a.layout.maxColumns&&a.layout.maxColumns<a.data.columns.length&&(a.blockError="This layout has a column limit of "+a.layout.maxColumns+", the column count is "+a.data.columns.length),console.log("broadcasting"),void a.$broadcast("layoutChanged",a.data.attributes.layout)):void(a.blockError="Stamp markup requires missing layout: "+o)}a.layouts=t,a.$watch(function(){return a.data.attributes.layout},function(t,n){n!==t&&i(n,t)}),a.data.attributes=a.data.attributes||{},a.data.attributes.layout=a.data.attributes.layout||"fluid",i(void 0,a.data.attributes.layout),a.getColumnClasses=function(t,n){n&&(t+=a.data.columns.length-1);var o="stack-column column-"+t+" ";if(void 0===a.layout.columnStyles)o+="col-md-12";else if(angular.isObject(a.layout.columnStyles)){for(var e in a.layout.columnStyles)if(a.layout.columnStyles.hasOwnProperty(e)){var l=a.layout.columnStyles[e];if(Array.isArray(l)){var i=t>l.length-1?l.length-1:t;o+="col-"+e+"-"+l[i]}else o+="col-"+e+"-"+l;o+=" "}}else o+="col-"+a.layout.columnStyles;return o},a.addComponent=function(t){var o=n.open({templateUrl:"../src/angular/templates/addComponentModal.html",controller:"StampAddComponentModalInstanceCtrl"});o.result.then(function(n){a.data.columns[t].components.push({type:n,data:{}})})},a.moveUp=function(){l.moveBlock(a.blockIndex,a.blockIndex-1)},a.moveDown=function(){l.moveBlock(a.blockIndex,a.blockIndex+1)},a.remove=function(){l.removeBlock(a.blockIndex)},a.changeLayout=function(t){if("fluid"===t)for(;a.data.columns.length>1;){var n=a.data.columns.pop();a.data.columns[0].components=a.data.columns[0].components.concat(n.components)}a.data.attributes.layout=t},a.emptyColumnCount=function(){if(!a.layout.maxColumns)return new Array(0);var t=a.layout.maxColumns-a.data.columns.length;return new Array(t>-1?t:0)},a.addColumn=function(){a.data.columns.push({components:[]})},a.removeColumn=function(t){a.data.columns.splice(t,1)}},controller:["$scope",function(t){this.removeComponent=function(n,a){t.data.columns[n].components.splice(a,1)},this.moveComponent=function(n,a,o,e){var l=t.data.columns[n].components,i=l.splice(o,1);t.data.columns[a].components.splice(e||0,0,i[0])}}]}}]),n.controller("StampAddComponentModalInstanceCtrl",["$scope","$uibModalInstance","stampComponents",function(t,n,a){t.components=a,t.insert=function(t){n.close(t)},t.close=function(){n.dismiss()}}]),n.directive("stampComponent",["$compile","stampComponents",function(n,a){return{restrict:"E",require:"^stampBlock",templateUrl:"../src/angular/templates/component.html",scope:{data:"=",index:"=",colIndex:"=",comIndex:"=",comCount:"="},link:function(o,e,l,i){function s(){var l=a[o.data.type];if(!l)return void(o.componentError="No component registered for type: "+o.data.type);var i=t(l.directive),s="<"+i+' data="data.data"></'+i+">",c=angular.element(e[0].getElementsByClassName("component-body")[0]);c.empty(),c.append(n(angular.element(s))(o))}return o.data&&o.data.type?(o.$watch("data.type",function(t,n){t!==n&&s()}),s(),o.remove=function(){i.removeComponent(o.colIndex,o.comIndex)},o.moveUp=function(){i.moveComponent(o.colIndex,o.colIndex,o.comIndex,o.comIndex-1)},void(o.moveDown=function(){i.moveComponent(o.colIndex,o.colIndex,o.comIndex,o.comIndex+1)})):void(o.componentError="Missing required component data")}}}])}(),function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/component.html",'<div class="component-wrap">\n  <div class="component-header">\n    <p class="pull-right">\n      <a data-ng-if="comIndex !== 0" data-ng-click="moveUp()">&#9650;</a>\n      <a data-ng-if="comIndex !== comCount - 1" data-ng-click="moveDown()">&#9660;</a>\n      <button type="button" class="close" aria-label="remove" data-ng-click="remove()"><span aria-hidden="true">&times;</span></button>\n    </p>\n  </div>\n  <div class="alert alert-danger" data-ng-if="componentError">{{componentError}}<br><br>Component Data:<pre>{{data | json}}</pre></div>\n  <div class="component-body">\n  </div>\n</div>')}])}();var stampAngularModule=angular.module("stampSetup",[]),stampSetupData={},stampRegisterFunctions={};["Components","Layouts","ComponentControls","BlockControls"].forEach(function(t){stampSetupData[t]={},stampRegisterFunctions[t]=function(t){return function(n,a){if(!n||""===n||stampSetupData[t].hasOwnProperty(n))throw new Error("Stamp Error: A unique name is required for a "+t+" definition");stampSetupData[t][n]=a}}(t),stampAngularModule.value("stamp"+t,stampSetupData[t])}),stampAngularModule.constant("stampRegister",{component:stampRegisterFunctions.Components,componentControl:stampRegisterFunctions.ComponentControls,layout:stampRegisterFunctions.Layouts,blockControl:stampRegisterFunctions.BlockControls}).value("stampOptions",{}).value("stampTranslations",{}).run(["stampRegister","$window","stampTranslations","stampOptions",function(t,n,a,o){t.layout("fluid",{label:"Fluid",maxColumns:void 0}),t.layout("oneColumn",{label:"One Column",maxColumns:1,columnStyles:{md:12}}),t.layout("twoColumn",{label:"Two Even Columns",maxColumns:2,columnStyles:{md:6,sm:12}}),t.layout("threeColumn",{label:"Three Columns",maxColumns:3,columnStyles:{md:4,sm:12}}),t.component("text",{directive:"stampTextComponent",label:"Text",icon:"fa fa-paragraph",toHTML:function(t,n){return"<p>"+t.data.value+"</p>"}}),t.component("title",{directive:"stampHeadingComponent",label:"Title",icon:"fa fa-header",toHTML:function(t,n){return"<h"+t.data.size+">"+t.data.value+"</h"+t.data.size+">"}}),t.component("image",{icon:"fa fa-picture-o",label:"Image",directive:"stampImageComponent",toHTML:function(t,n){var a="img img-responsive";return'<img src="'+t.data.url+'" class="'+a+'" alt="'+(t.data.alt||"")+'">'}}),t.component("table",{icon:"fa fa-table",label:"Table",directive:"stampTableComponent",toHTML:function(t,n){return"<table><td>TODO</td></table>"}})}]).directive("stampTextComponent",[function(){return{restrict:"E",template:'<textarea stamp-auto-height placeholder="Enter Text.." class="form-control" ng-model="data.value"></textarea>',scope:{data:"="}}}]).directive("stampHeadingComponent",[function(){return{restrict:"E",template:'<div class="input-group size-h{{data.size || 1}}">                <input type="text" placeholder="Enter Heading Text.." class="form-control" ng-model="data.value">                <div class="input-group-btn" uib-dropdown>                  <button type="button" class="btn btn-default" uib-dropdown-toggle>{{"H" + data.size}} <span class="caret"></span></button>                  <ul class="dropdown-menu" uib-dropdown-menu>                    <li ng-repeat="size in [1, 2, 3]"><a ng-click="data.size = size">{{"H" + size}}</a></li>                  </ul>                </div>              </div>',scope:{data:"="},link:function(t){void 0===t.data.size&&(t.data.size=1)}}}]).directive("stampImageComponent",[function(){return{restrict:"E",template:'<div ng-class="{\'edit-mode\':editing}" style="position: relative;">                <div ng-show="editing" class="edit-overlay">                  <button class="btn pull-right" ng-click="toggleEdit()">Close</button>                  <h4>Alignment</h4>                  <div class="btn-group">                    <label class="btn btn-default" ng-model="data.alignment" uib-btn-radio="\'left\'">Left</label>                    <label class="btn btn-default" ng-model="data.alignment" uib-btn-radio="\'center\'">Center</label>                    <label class="btn btn-default" ng-model="data.alignment" uib-btn-radio="\'right\'">Right</label>                  </div>                  <button type="button" class="btn btn-primary" ng-click="data.alignment=null">Clear</button>                  <h4>Styles</h4>                  <input class="form-control" type="text" ng-model="data.style">                  <h4>Caption</h4>                  <input class="form-control" type="text" ng-model="data.figureCaption">                </div>                <button class="btn btn-transparent pull-right" style="position:absolute;right:8px;" ng-hide="editing" ng-click="toggleEdit()">Edit</button>                <figure ng-class="getClasses()" style="{{data.style || \'\'}}">                  <img ng-src="{{data.url}}" alt="{{data.alt || \'\'}}" class="img-responsive figure-img">                  <figcaption ng-if="data.figureCaption" class="figure-caption text-center">{{data.figureCaption}}</figcaption>                </figure>              </div>',scope:{data:"="},link:function(t,n,a){t.editing=!1,t.clearAll=function(){t.data.width=null,t.data.alignment=null},t.toggleEdit=function(){t.editing=!t.editing},t.getClasses=function(){var n="figure ";switch(t.data.alignment){case"left":n+="pull-left ";break;case"center":n+="center-block ";break;case"right":n+="pull-right "}return n}}}}]).directive("stampTableComponent",[function(){return{restrict:"E",template:'<div class="table">                <table><td>TODO: Load table format</td></table>              </div>',scope:{data:"="},link:function(t,n,a){}}}]),function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/editor.html",'<div class="stamp-stack-container">\n <!-- {{json | json}} -->\n  <div class="stamp-block-wrapper block-{{$index}} row" data-ng-repeat="block in json.blocks">\n    <stamp-block data="block" block-index="$index" block-count="json.blocks.length" class="clearfix"></stamp-block>\n  </div>\n  <div class="no-config" data-ng-if="!json.blocks || json.blocks.length == 0">Start by adding a block!</div>\n  <div data-ng-if="!locked && !readOnly"><input class="btn btn-default btn-lg btn-block" type="button" value="+ Block" data-ng-click="addBlock()"></div>\n</div>')}])}();