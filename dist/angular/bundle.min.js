"use strict";!function(t){if(t.htmlMapper=function(t,n,o){function e(n,e){Object.keys(t.stampBlockControls).forEach(function(a,l){var i=t.stampBlockControls[a];void 0!==i.preRender&&(n=i.preRender.call(o,n,e))});var l=a(n,e);return Object.keys(t.stampBlockControls).forEach(function(n,a){var i=t.stampBlockControls[n];void 0!==i.postRender&&(l=i.postRender.call(o,l,e))}),l}function a(n,o){var e=n.attributes&&n.attributes.layout?n.attributes.layout:"oneColumn",a=t.stampLayouts[e],i="";if(!a){if("oneColumn"===e)return console.log("Warning! Missing layout config and fallback oneColumn layout. Exiting."),i;console.log("Warning! Missing layout config, reverting to oneColumn"),e="oneColumn",a=t.stampLayouts.oneColumn}return i+="<div>",n.columns.forEach(function(t,n){if(void 0!==a.maxColumns&&n+1>a.maxColumns)return void console.log("Warning! Data exceeds maxColumns for this layout, Omitting extra columns.");var e=l(t,n,a,o);e&&(i+=e)}),i+="</div>"}function l(t,n,o){var e='<div class="';return e+=s(n,o),e+='">',t.components.forEach(function(t,n){var a=i(t,n,o);a&&(e+=a)}),e+="</div>"}function i(n,e,a){var l="";return Object.keys(t.stampComponentControls).forEach(function(a,l){var i=t.stampComponentControls[a];void 0!==i.preRender&&(n=i.preRender.call(o,n,e))}),l=c(n,e,a),Object.keys(t.stampComponentControls).forEach(function(n,a){var i=t.stampComponentControls[n];void 0!==i.postRender&&(l=i.postRender.call(o,l,e))}),l}function c(n,e,a){var l=t.stampComponents[n.type];return l?l.toHTML?l.toHTML.call(o,n,a):(console.log("Warning! Component is missing a toHTML function: "+n.type),""):(console.log("Warning! Missing component: "+n.type),"")}function s(t,n){var o="";if(void 0===n.columnStyles)o+="col-md-12";else if("string"==typeof n.columnStyles)o+="col-"+n.columnStyles;else for(var e in n.columnStyles)if(n.columnStyles.hasOwnProperty(e)){var a=n.columnStyles[e];if(Array.isArray(a)){var l=t>a.length-1?a.length-1:t;o+="col-"+e+"-"+a[l]}else o+="col-"+e+"-"+a;o+=" "}return o}var r="";return o=o||{},n&&n.blocks?(n.blocks.forEach(function(t,n){r+=e(t,n)}),r):r},angular){var n=angular.module("stamp.mappers",[]);n.factory("StampHTML",["stampLayouts","stampComponents","stampComponentControls","stampBlockControls",function(n,o,e,a){function l(n,o){try{return t.htmlMapper(i,n,o||{})}catch(e){console.log("Warning! Failed to export Stamp JSON to HTML",e)}}var i={stampLayouts:n,stampBlockControls:a,stampComponents:o,stampComponentControls:e};return{generate:function(t,n){return l(t,n)}}}])}}("undefined"==typeof exports?window._stampMappers={}:exports),function(){function t(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var n=angular.module("stamp",["stamp.mappers","stampSetup","ui.bootstrap"]);n.directive("stampEditor",["$rootScope","$compile","$timeout","$window","stampOptions",function(t,n,o,e,a){var l=0,i="ui-stamp-editor-";return{require:"ngModel",templateUrl:"../src/angular/templates/editor.html",link:function(t,n,o,e){function c(){t.locked=o.locked}function s(){t.readOnly=o.readOnly}var r={},u={};t.json={},o.$set("id",i+l++),console.log("Stamp directive given ID: "+i+l),angular.extend(u,t.$eval(o.stampOptions)),angular.extend(r,a||{},u),t.attributes=angular.extend({locked:!1,readOnly:!1},{locked:!!o.locked,readOnly:!!o.readOnly},r),o.$observe("locked",c),o.$observe("readOnly",s),o.ngModel?t.$watch(function(){return JSON.stringify(e.$modelValue)},function(n,o){t.json=e.$modelValue}):console.log("Warning: missing ng-model definition on stamp editor"),t.addBlock=function(n){t.json.blocks.splice(void 0!==n?n:t.json.blocks.length,0,{attributes:{layout:"oneColumn"},columns:[{components:[{type:"text",data:{}}]}]})}},controller:["$scope",function(t){this.getAttributes=function(){return t.attributes},this.removeBlock=function(n){t.json.blocks.splice(n,1)},this.moveBlock=function(n,o){var e=t.json.blocks.splice(n,1);t.json.blocks.splice(o,0,e[0])}}]}}]),n.directive("stampAutoHeight",function(t){return{restrict:"A",link:function(n,o){var e=function(){var t=o[0].scrollHeight;25>t?o[0].style.height="25px":(t+=10,o[0].style.height=t+"px")};n.$on("layoutChanged",function(){o[0].style.height="auto",t(e,10)}),t(e,0)}}}),n.directive("stampBlock",["stampLayouts","$uibModal","$timeout","$compile","stampBlockControls",function(n,o,e,a,l){return{restrict:"E",require:"^stampEditor",templateUrl:"../src/angular/templates/block.html",scope:{data:"=",blockIndex:"=",blockCount:"="},link:function(o,e,i,c){function s(t,e){return o.layout=n[e],o.blockError=!1,o.layout?(void 0!==o.layout.maxColumns&&o.layout.maxColumns<o.data.columns.length&&(o.blockError="This layout has a column limit of "+o.layout.maxColumns+", the column count is "+o.data.columns.length),void o.$broadcast("layoutChanged",o.data.attributes.layout)):void(o.blockError="Stamp markup requires missing layout: "+e)}function r(n){var o=t(n);return"<"+o+"></"+o+">"}o.layouts=n,o.$watch("data.attributes.layout",function(t,n){n!==t&&s(n,t)}),o.data.attributes=o.data.attributes||{},o.data.attributes.layout=o.data.attributes.layout||"oneColumn",s(void 0,o.data.attributes.layout);var u="",d=c.getAttributes(),m=d&&d.blockControlLayout?d.blockControlLayout:Object.keys(l);m.forEach(function(t){var n=l[t];n&&n.directive&&(u+=r(n.directive))});var p=angular.element(e[0].getElementsByClassName("block-controls")[0]);p.empty(),p.append(a(angular.element(u))(o)),o.getColumnClasses=function(t,n){n&&(t+=o.data.columns.length-1);var e="stack-column column-"+t+" ";if(void 0===o.layout.columnStyles)e+="col-md-12";else if(angular.isObject(o.layout.columnStyles)){for(var a in o.layout.columnStyles)if(o.layout.columnStyles.hasOwnProperty(a)){var l=o.layout.columnStyles[a];if(Array.isArray(l)){var i=t>l.length-1?l.length-1:t;e+="col-"+a+"-"+l[i]}else e+="col-"+a+"-"+l;e+=" "}}else e+="col-"+o.layout.columnStyles;return e},o.moveUp=function(){c.moveBlock(o.blockIndex,o.blockIndex-1)},o.moveDown=function(){c.moveBlock(o.blockIndex,o.blockIndex+1)},o.remove=function(){c.removeBlock(o.blockIndex)},o.mergeColumns=function(){for(;o.data.columns.length>(o.data.attributes.maxColumns||1);){var t=o.data.columns.pop();o.data.columns[0].components=o.data.columns[0].components.concat(t.components)}},o.changeLayout=function(t){o.data.attributes.layout=t},o.emptyColumnCount=function(){if(!o.layout.maxColumns)return new Array(0);var t=o.layout.maxColumns-o.data.columns.length;return new Array(t>-1?t:0)},o.addColumn=function(){o.data.columns.push({components:[]})},o.removeColumn=function(t){o.data.columns.splice(t,1)}},controller:["$scope",function(t){this.removeComponent=function(n,o){t.data.columns[n].components.splice(o,1)},this.moveComponent=function(n,o,e,a){var l=t.data.columns[n].components,i=l.splice(e,1);(void 0===a||a>t.data.columns[o].components.length)&&(a=t.data.columns[o].components.length),t.data.columns[o].components.splice(a,0,i[0])},t.addComponent=this.addComponent=function(n,a,l){if(l)t.data.columns[n].components.splice(a||t.data.columns[n].components.length,0,{type:l.type,data:l.data||{}}),e(function(){t.$broadcast("componentFocus",n,a)},0);else{var i=o.open({templateUrl:"../src/angular/templates/addComponentModal.html",controller:"StampAddComponentModalInstanceCtrl"});i.result.then(function(o){t.data.columns[n].components.splice(a||t.data.columns[n].components.length,0,{type:o.type,data:o.data||{}}),t.$broadcast("componentFocus",n,a)})}}}]}}]),n.controller("StampAddComponentModalInstanceCtrl",["$scope","$uibModalInstance","stampComponents",function(t,n,o){t.components=o,t.insert=function(t){n.close({type:t})},t.close=function(){n.dismiss()}}]),n.directive("stampComponent",["$compile","stampComponents","stampComponentControls",function(n,o,e){return{restrict:"E",require:["^stampBlock","^stampEditor"],templateUrl:"../src/angular/templates/component.html",scope:{data:"=",index:"=",colIndex:"=",colCount:"=",comIndex:"=",comCount:"="},link:function(a,l,i,c){function s(){var i=o[a.data.type];if(!i)return void(a.componentError="No component registered for type: "+a.data.type);var c=t(i.directive),s="<"+c+' data="data.data"></'+c+">",r="",d=u.getAttributes(),m=d&&d.componentControlLayout?d.componentControlLayout:Object.keys(e);m.forEach(function(n){var o=e[n];if(o&&o.directive){var a=t(o.directive);r+="<"+a+"></"+a+">"}});var p='<div class="component-header">                         <p class="pull-right">'+r+'                         </p>                       </div>                       <div ng-if="componentError" class="alert alert-danger">{{componentError}}<br><br>Component Data:<pre>{{data | json}}</pre></div>                       <div class="component-body">'+s+"</div>";l.empty(),l.append(n(angular.element(p))(a))}var r=c[0],u=c[1];return a.data&&a.data.type?(a.$watch("data.type",function(t,n){t!==n&&s()}),s(),a.addComponent=r.addComponent,a.remove=function(){r.removeComponent(a.colIndex,a.comIndex)},a.moveUp=function(){r.moveComponent(a.colIndex,a.colIndex,a.comIndex,a.comIndex-1)},a.moveDown=function(){r.moveComponent(a.colIndex,a.colIndex,a.comIndex,a.comIndex+1)},a.moveLeft=function(){r.moveComponent(a.colIndex,a.colIndex-1,a.comIndex,a.comIndex)},void(a.moveRight=function(){r.moveComponent(a.colIndex,a.colIndex+1,a.comIndex,a.comIndex)})):void(a.componentError="Missing required component data")}}}])}(),function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/addComponentModal.html",'<div class="stamp-modal stamp-modal-add-component modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-label="Close" data-ng-click="close()"><span aria-hidden="true">&times;</span></button>\n    <h4 class="modal-title">Add Component</h4>\n  </div>\n  <div class="modal-body">\n    <div class="component-list">\n      <div class="component-list-item" data-ng-if="value" data-ng-class="{\'no-icon\' : !value.icon}" data-ng-repeat="(key, value) in components" data-ng-click="insert(key)">\n        <i class="{{value.icon}}" data-ng-if="value.icon"></i>\n        <span>{{value.label}}</span>\n      </div>\n    </div>\n  </div>\n</div>')}])}();var stampAngularModule=angular.module("stampSetup",[]),stampSetupData={},stampRegisterFunctions={};["Components","Layouts","ComponentControls","BlockControls"].forEach(function(t){stampSetupData[t]={},stampRegisterFunctions[t]=function(t){return function(n,o){if(!n||""===n)throw new Error("Stamp Error: A unique name is required for a "+t+" definition");stampSetupData[t][n]=o}}(t),stampAngularModule.value("stamp"+t,stampSetupData[t])}),stampAngularModule.constant("stampRegister",{component:stampRegisterFunctions.Components,componentControl:stampRegisterFunctions.ComponentControls,layout:stampRegisterFunctions.Layouts,blockControl:stampRegisterFunctions.BlockControls}).value("stampOptions",{componentControlLayout:["moveComponentArrows","removeComponent"],blockControlLayout:["layoutControl","moveBlockArrows","removeBlock"]}).value("stampTranslations",{}).run(["stampRegister","$window","stampTranslations",function(t,n,o){t.layout("oneColumn",{label:"One Column",maxColumns:1,columnStyles:{md:12}}),t.layout("twoColumn",{label:"Two Even Columns",maxColumns:2,columnStyles:{md:6,sm:12}}),t.layout("threeColumn",{label:"Three Columns",maxColumns:3,columnStyles:{md:4,sm:12}}),t.component("text",{directive:"stampTextComponent",label:"Text",icon:"fa fa-paragraph",toHTML:function(t,n){return"<p>"+t.data.value+"</p>"}}),t.component("title",{directive:"stampHeadingComponent",label:"Title",icon:"fa fa-header",toHTML:function(t,n){return"<h"+t.data.size+">"+t.data.value+"</h"+t.data.size+">"}}),t.component("image",{icon:"fa fa-picture-o",label:"Image",directive:"stampImageComponent",toHTML:function(t,n){function o(){var n="figure ";switch(t.data["float"]){case"left":n+="pull-left ";break;case"center":n+="center-block ";break;case"right":n+="pull-right "}return null!==t.data.percentageWidth&&void 0!==t.data.percentageWidth&&(n+="width-"+t.data.percentageWidth),n}var e="";return e+='<figure class="'+o()+'" style="display: table;">',e+='<img src="'+t.data.url+'" class="img-responsive figure-img" style="width:100%" alt="'+(t.data.alt||"")+'">',t.data.figureCaption&&t.data.figureCaption.length&&(e+='<figcaption class="figure-caption text-center" style="display: table-caption; caption-side: bottom;">'+t.data.figureCaption+"</figcaption>"),e+="</figure>"}}),t.component("table",{icon:"fa fa-table",label:"Table",directive:"stampTableComponent",toHTML:function(t,n){return"<table><td>TODO</td></table>"}}),t.componentControl("moveComponentArrows",{directive:"stampMoveComponentControls"}),t.blockControl("moveBlockArrows",{directive:"stampMoveBlockControls"}),t.componentControl("removeComponent",{directive:"stampRemoveControl"}),t.blockControl("removeBlock",{directive:"stampRemoveControl"}),t.blockControl("layoutControl",{directive:"stampChangeLayoutControl"})}]).directive("stampRemoveControl",[function(){return{restrict:"E",scope:!1,template:'<button type="button" class="btn btn-default btn-xs" ng-click="remove()" aria-label="remove"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>'}}]).directive("stampChangeLayoutControl",[function(){return{restrict:"E",scope:!1,template:'<span uib-dropdown>        <a href id="simple-dropdown" uib-dropdown-toggle class="btn btn-xs btn-default">Layout: {{layouts[data.attributes.layout].label}}</a>        <ul class="dropdown-menu" uib-dropdown-menu aria-labelledby="simple-dropdown">          <li ng-repeat="(key, value) in layouts" ng-if="value">            <a ng-click="changeLayout(key)">{{value.label}}</a>          </li>        </ul>      </span>'}}]).directive("stampMoveComponentControls",[function(){return{restrict:"E",scope:!1,template:'<div class="btn-group" role="group" aria-label="...">                  <button type="button" class="btn btn-default btn-xs" ng-if="colIndex !== 0" ng-click="moveLeft()">&#9668;</button>                  <button type="button" class="btn btn-default btn-xs" ng-if="comIndex !== 0" ng-click="moveUp()">&#9650;</button>                  <button type="button" class="btn btn-default btn-xs" ng-if="comIndex !== comCount - 1" ng-click="moveDown()">&#9660;</button>                  <button type="button" class="btn btn-default btn-xs" ng-if="colIndex + 1 < colCount" ng-click="moveRight()">&#9658;</button>                </div>'}}]).directive("stampMoveBlockControls",[function(){return{restrict:"E",scope:!1,template:'<div class="btn-group" role="group" aria-label="...">                  <button type="button" class="btn btn-default btn-xs" ng-if="blockIndex !== 0" ng-click="moveUp()">&#9650;</button>                  <button type="button" class="btn btn-default btn-xs" ng-if="blockIndex !== blockCount - 1" ng-click="moveDown()">&#9660;</button>                </div>'}}]).directive("stampEnterHandle",[function(){return{restrict:"AC",scope:!1,link:function(t,n,o){t.type||(t.type="text"),n.bind("keydown keypress",function(n){13===n.which&&(t.$apply(function(){t.$parent.addComponent(t.$parent.colIndex,t.$parent.comIndex+1,{type:t.type})}),n.preventDefault())})}}}]).directive("stampTextComponent",[function(){return{restrict:"E",template:'<textarea stamp-auto-height stamp-enter-handle placeholder="Enter Text.." class="form-control" ng-model="data.value"></textarea>',scope:{data:"="},link:function(t,n,o){t.$on("$destroy",t.$on("componentFocus",function(o,e,a){e===t.$parent.colIndex,a===t.$parent.comIndex&&n[0].children[0].focus()}))}}}]).directive("stampHeadingComponent",[function(){return{restrict:"E",template:'<div class="input-group size-h{{data.size || 1}}">                <input type="text" stamp-enter-handle placeholder="Enter Heading Text.." class="form-control" ng-model="data.value">                <div class="input-group-btn" uib-dropdown>                  <button type="button" class="btn btn-default" uib-dropdown-toggle>{{"H" + data.size}} <span class="caret"></span></button>                  <ul class="dropdown-menu" uib-dropdown-menu>                    <li ng-repeat="size in [1, 2, 3]"><a ng-click="data.size = size">{{"H" + size}}</a></li>                  </ul>                </div>              </div>',scope:{data:"="},link:function(t){void 0===t.data.size&&(t.data.size=1)}}}]).directive("stampImageComponent",[function(){return{restrict:"E",template:'<div ng-class="{\'edit-mode\':editing}" style="position: relative;">                <div ng-show="editing" class="edit-overlay">                  <button class="btn btn-default pull-right" ng-click="toggleEdit()">Close</button>                  <h4>URL</h4>                  <input class="form-control" type="text" ng-model="data.url">                  <h4>Alt</h4>                  <input class="form-control" type="text" ng-model="data.alt">                  <h4>Float</h4>                  <div class="btn-group">                    <label class="btn btn-default" ng-model="data.float" uib-btn-radio="\'left\'">Left</label>                    <label class="btn btn-default" ng-model="data.float" uib-btn-radio="\'center\'">Center</label>                    <label class="btn btn-default" ng-model="data.float" uib-btn-radio="\'right\'">Right</label>                    <label class="btn btn-primary" ng-click="data.float = null">Clear</label>                  </div>                  <h4>Size</h4>                  <div class="btn-group">                    <label class="btn btn-default" ng-model="data.percentageWidth" uib-btn-radio="\'25\'">25%</label>                    <label class="btn btn-default" ng-model="data.percentageWidth" uib-btn-radio="\'50\'">50%</label>                    <label class="btn btn-default" ng-model="data.percentageWidth" uib-btn-radio="\'75\'">75%</label>                    <label class="btn btn-default" ng-model="data.percentageWidth" uib-btn-radio="\'100\'">100%</label>                    <label class="btn btn-primary" ng-click="data.percentageWidth = null">Clear</label>                  </div>                  <h4>Caption</h4>                  <input class="form-control" type="text" ng-model="data.figureCaption">                </div>                <button class="btn btn-transparent pull-right" style="position:absolute;right:8px;top:8px;" ng-hide="editing" ng-click="toggleEdit()">Edit</button>                <figure ng-class="getClasses()" style="display: table;">                  <img ng-src="{{data.url}}" alt="{{data.alt || \'\'}}" class="img-responsive figure-img" style="width:100%;">                  <figcaption ng-if="data.figureCaption" class="figure-caption text-center" style="display: table-caption; caption-side: bottom;">{{data.figureCaption}}</figcaption>                </figure>              </div>',scope:{data:"="},link:function(t,n,o){t.editing=!1,t.clearAll=function(){t.data.percentageWidth=null,t.data["float"]=null},t.toggleEdit=function(){t.editing=!t.editing},t.getClasses=function(){var n="figure ";switch(t.data["float"]){case"left":n+="pull-left ";break;case"center":n+="center-block ";break;case"right":n+="pull-right "}return null!==t.data.percentageWidth&&void 0!==t.data.percentageWidth&&(n+="width-"+t.data.percentageWidth),n}}}}]).directive("stampTableComponent",[function(){return{restrict:"E",template:'<div class="table">                <table><td>TODO: Load table format</td></table>              </div>',scope:{data:"="},link:function(t,n,o){}}}]),function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/block.html",'<div class="block-header clearfix">\n    <span class="pull-right">\n      <span class="block-controls"><!-- Dynamically inserts block controls --></span>\n    </span>\n</div>\n<div class="alert alert-danger" data-ng-if="layout.maxColumns && layout.maxColumns < data.columns.length">This layout has a column limit of {{layout.maxColumns}}, the column count is {{data.columns.length}}, switch to a {{data.columns.length}} column layout <button class="btn btn-default" data-ng-click="mergeColumns()">Auto Merge</button></div>\n<div class="alert alert-danger" data-ng-if="!layout.maxColumns">No Layout Set</div>\n<div class="block-body" data-ng-if="layout.maxColumns">\n  <div data-ng-class="getColumnClasses($index)" data-ng-repeat="column in data.columns | limitTo:layout.maxColumns">\n    <div class="stamp-component-wrapper component-{{$index}}" data-ng-repeat="component in column.components track by $index">\n      <stamp-component data="component" col-index="$parent.$index" com-index="$index" com-count="column.components.length" col-count="data.columns.length"></stamp-component>\n    </div>\n    <div data-ng-if="!parent.locked && !parent.readOnly">\n      <input class="btn btn-warning btn-lg btn-block" type="button" value="Remove Column" data-ng-if="column.components.length == 0" data-ng-click="removeColumn($index)">\n      <input class="btn btn-default btn-lg btn-block" type="button" value="+ Component" data-ng-click="addComponent($parent.$index)">\n    </div>\n  </div>\n  <!-- enable this instead of the below option when you\'ve added the ability to add no middle column if 3 are missing on a 3 col layout <div ng-if="emptyColumnCount().length > 0" ng-class="getColumnClasses($index, true)" ng-repeat="emptyColumn in emptyColumnCount() track by $index">\n    <div ng-if="!parent.locked && !parent.readOnly"><input class="btn btn-default btn-lg btn-block" type="button" ng-click="addColumn($index)" value="+ Column"></input></div>\n  </div>-->\n  <div data-ng-if="!parent.locked && !parent.readOnly && emptyColumnCount().length > 0" data-ng-class="getColumnClasses(0, true)">\n    <input class="btn-block btn btn-default btn-lg" type="button" value="+ Column" data-ng-click="addColumn()">\n  </div>\n</div>')}])}(),function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/component.html",'<div class="component-wrap">\n  <!-- Dynamically created in stamp.js component directive -->\n</div>')}])}(),function(t){try{t=angular.module("stamp")}catch(n){t=angular.module("stamp",[])}t.run(["$templateCache",function(t){t.put("src/angular/templates/editor.html",'<div class="stamp-stack-container">\n <!-- {{json | json}} -->\n  <div class="stamp-block-wrapper block-{{$index}} row" data-ng-repeat="block in json.blocks">\n    <stamp-block data="block" block-index="$index" block-count="json.blocks.length" class="clearfix"></stamp-block>\n  </div>\n  <div class="no-config" data-ng-if="!json.blocks || json.blocks.length == 0">Start by adding a block!</div>\n  <div data-ng-if="!locked && !readOnly"><input class="btn btn-default btn-lg btn-block" type="button" value="+ Block" data-ng-click="addBlock()"></div>\n</div>')}])}();